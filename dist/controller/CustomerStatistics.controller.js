sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(t,e,a){"use strict";return t.extend("Project.Project.controller.CustomerStatistics",{onInit:function(){this.oOrdersModel=new e;this.oOrdersModel.loadData("http://localhost:8080/GiftShop/api/orders","",false);this.orders=this.oOrdersModel.getData();this.oCategoryModel=new e;this.oCategoryModel.loadData("http://localhost:8080/GiftShop/api/categories","",false);this.categories=this.oCategoryModel.getData();this.oCustomersModel=new e;this.oCustomersModel.loadData("http://localhost:8080/GiftShop/api/customers","",false);this.customers=this.oCustomersModel.getData();this.oRSModel=new e;this.oRSModel.loadData("http://localhost:8080/GiftShop/api/regionstatistics","",false);this.regionstats=this.oRSModel.getData();this.loadCategoryChart();this.loadMap()},loadCategoryChart:function(){var t=this.getOwnerComponent().getModel("i18n").getResourceBundle();var a=[];for(var o=0;o<this.categories.length;o++){var s={name:this.categories[o].name,quantity:0};a.push(s)}for(o=0;o<this.orders.length;o++){var r=this.orders[o].orderProductList;for(var i=0;i<r.length;i++){var n=r[i].product;for(var l=0;l<a.length;l++){if(a[l].name===n.category.name){a[l].quantity=a[l].quantity+r[i].quantity}}}}var h=new e;h.setData(a);var d=this.getView().byId("categoryChart");d.setModel(h);var g=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{axis:1,name:t.getText("Category"),value:"{name}"}],measures:[{name:t.getText("CategoryQuantity"),value:"{quantity}"}],data:{path:"/"}});d.setDataset(g)},loadMap:function(){var t=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.router=this.getOwnerComponent().getRouter();var a=this.getView().byId("GeoMap");var o={MapProvider:[{name:"Openstreetmap",type:"",description:"",tileX:"256",tileY:"256",maxLOD:"20",centerPosition:"13.407965;52.517906",copyright:t.getText("Copyright"),Source:[{id:"s1",url:t.getText("GeoMap")}]}],MapLayerStacks:[{name:"DEFAULT",MapLayer:{name:"layer1",refMapProvider:"Openstreetmap",opacity:"1",colBkgnd:"RGB(255,255,255)"}}]};a.setMapConfiguration(o);a.setRefMapLayerStack("DEFAULT");this.oCSeatsModel=new e;this.oCSeatsModel.loadData(jQuery.sap.getModulePath("Project.Project.model","/countrySeats.json"),null,false);this.cSeats=JSON.parse(this.oCSeatsModel.getJSON());this.oMapSpots=this.getView().byId("spots");this.oMapSpots.setModel(this.oCSeatsModel);var s=0;for(var r=0;r<this.regionstats.length;r++){s=s+parseInt(this.regionstats[r].soldProducts,10)}var i=this.oMapSpots.getItems();for(r=0;r<i.length;r++){for(var n=0;n<this.regionstats.length;n++){if(i[r].getKey()===this.regionstats[n].region){var l=(parseInt(this.regionstats[n].soldProducts,10)/s*100).toPrecision(2);i[r].getItem().setPercentage(parseFloat(l,10))}}}}})});