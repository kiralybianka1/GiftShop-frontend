sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter"],function(e,t,o,i,a,s){"use strict";return e.extend("Project.Project.controller.Other",{onInit:function(){this.oCategoryModel=new t;this.oCategoryModel.loadData("http://localhost:8080/GiftShop/api/categories","",false);this.categories=this.oCategoryModel.getData();this.getView().setModel(this.oCategoryModel);var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var o=this;this.oTable=this.byId("categoryList");this.oReadOnlyTemplate=this.byId("categoryList").removeItem(0);this.rebindTable(this.oReadOnlyTemplate,"Navigation");this.oEditableTemplate=new sap.m.CustomListItem({content:[new sap.m.VBox({items:[new sap.ui.core.Icon({src:"sap-icon://customer-view",size:"2.625rem",color:"Default",tooltip:"{i18n>Category}"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Title({text:e.getText("Name")}),new sap.m.Input({value:"{name}"}),new sap.m.Title({text:e.getText("CategoryTax")}),new sap.m.Input({value:"{taxRate}"})]}),new sap.m.OverflowToolbar({design:"Solid",content:[new sap.m.ToolbarSpacer,new sap.m.Button({icon:"sap-icon://edit",type:"Accept",press:function(e){o.onEditCategoryButtonPress(e)}})]}).addStyleClass("sapContrast")]})},rebindTable:function(e,t){this.oTable.bindItems({path:"/",template:e,key:"id"}).setKeyboardMode(t)},onEditButtonPress:function(e){this.getView().byId("idModifyCategory").setVisible(false);this.getView().byId("idBackCategory").setVisible(true);this.getView().byId("idAddCategory").setVisible(false);this.rebindTable(this.oEditableTemplate,"Edit")},onBack:function(){this.getView().byId("idModifyCategory").setVisible(true);this.getView().byId("idBackCategory").setVisible(false);this.getView().byId("idAddCategory").setVisible(true);this.rebindTable(this.oReadOnlyTemplate,"Navigation");window.location.reload()},onSearch:function(e){var t=[];var o=e.getSource().getValue();if(o&&o.length>0){t=new i({filters:[new i("name",a.Contains,o)]})}this.getView().byId("categoryList").getBinding("items").filter(t,"Application")},onSettingsButtonPressed:function(){if(!this.settingsDialog){this.settingsDialog=sap.ui.xmlfragment("Project.Project.view.Fragments.CategorySettings",this);this.settingsDialog.setModel(this.oCategoryModel,"category");this.getView().addDependent(this.settingsDialog)}this.settingsDialog.open()},handleConfirm:function(e){var t=e.getParameters(),o=this.getView().byId("categoryList").getBinding("items"),i,a,n=[],r=[];i=t.sortItem.getKey();a=t.sortDescending;n.push(new s(i,a));o.sort(n)},onEditCategoryButtonPress:function(e){var t=this.getView().getModel("i18n").getResourceBundle();var i=e.getSource().getBindingContext();var a=parseInt(i.getProperty(null,i).id,10);var s=i.getProperty(null,i).name;var n=i.getProperty(null,i).taxRate;var r=this.checkCategoryData(s,n);if(r){var l={id:a,name:s,taxRate:parseInt(n,10)};var g=this;o.confirm(t.getText("ConfirmCategoryModify"),{actions:[o.Action.YES,o.Action.NO],onClose:function(e){if(e===o.Action.YES){g.modifyCategory(l)}}})}else{o.error(t.getText("CategoryModifyErrorMessage"))}},checkCategoryDelete:function(e){this.oProductsModel=new t;this.oProductsModel.loadData("http://localhost:8080/GiftShop/api/products","",false);this.products=this.oProductsModel.getData();for(var o=0;o<this.products.length;o++){if(parseInt(this.products[o].category.id,10)===e){return false}}return true},onDeleteButtonPress:function(e){var t=e.getSource().getBindingContext();var i=t.getProperty(null,t).id;var a=this.getView().getModel("i18n").getResourceBundle();var s=this;var n=this.checkCategoryDelete(i);if(n){o.confirm(a.getText("ConfirmDelete"),{actions:[o.Action.YES,o.Action.NO],onClose:function(e){if(e===o.Action.YES){s.deleteCategory(i)}}})}else{o.error(a.getText("CategoryDeleteErrorMessage"))}},onAddButtonPress:function(e){var t=this.getView().getModel("i18n").getResourceBundle();var o=this;this.resizableDialog=new sap.m.Dialog({title:t.getText("NewCategory"),contentWidth:"400px",contentHeight:"200px",resizable:true,content:new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Title({text:t.getText("Name")}),new sap.m.Input({id:"newCategoryName",type:"Text",required:true}),new sap.m.Title({text:t.getText("CategoryTax")}),new sap.m.Input({id:"newCategoryTax",type:"Number",required:true})]}),beginButton:new sap.m.Button({text:t.getText("Add"),press:function(){o.createCategory()}.bind(this)}),endButton:new sap.m.Button({text:t.getText("Close"),press:function(){this.resizableDialog.close();this.resizableDialog.destroy()}.bind(this)})});this.getView().addDependent(this.resizableDialog);this.resizableDialog.open()},checkCategoryData:function(e,t){if(e===""||Number.isNaN(t)||t===""){return false}if(Number(t)<0||Number(t)>100){return false}return true},modifyCategory:function(e){var t=this.getView().getModel("i18n").getResourceBundle();jQuery.ajax({type:"PUT",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/categories",dataType:"json",data:JSON.stringify(e)});o.success(t.getText("CategoryModifySuccess"),{onClose:function(e){window.location.reload()}})},createCategory:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=sap.ui.getCore().byId("newCategoryName").getValue();var i=sap.ui.getCore().byId("newCategoryTax").getValue();var a=this.checkCategoryData(t,i);if(a){var s={name:t,taxRate:i};jQuery.ajax({type:"POST",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/categories",dataType:"json",data:JSON.stringify(s)});this.resizableDialog.destroy();o.success(e.getText("CategoryAddSuccess"),{onClose:function(e){window.location.reload()}})}else{o.error(e.getText("CategoryAddErrorMessage"))}},deleteCategory:function(e){var t=this.getView().getModel("i18n").getResourceBundle();var e=parseInt(e,10);var i={id:e};jQuery.ajax({type:"DELETE",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/categories/"+e,dataType:"json",data:JSON.stringify(i)});o.success(t.getText("CategoryDeleteSuccess"),{onClose:function(e){window.location.reload()}})}})});