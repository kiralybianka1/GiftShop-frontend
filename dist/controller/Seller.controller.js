sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","./Client","Project/Project/model/fulfillmentFormatter","Project/Project/model/productsQuantityFormatter","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,o,s,l,i,a){"use strict";return r.extend("Project.Project.controller.Seller",{formatter:[o,s],name:"seller",onInit:function(){var e=this.getOwnerComponent();this.oRouter=e.getRouter();this.oModel=e.getModel();this.oRouter.getRoute("Sellers").attachPatternMatched(this._onProductMatched,this);this.oRouter.getRoute("Seller").attachPatternMatched(this._onProductMatched,this)},_onProductMatched:function(e){this._seller=e.getParameter("arguments").seller||this._seller||"0";this.oSellerModel=new t;this.oSellerModel.loadData("http://localhost:8080/GiftShop/api/sellers","",false);this.sellers=this.oSellerModel.getData();for(var r=0;r<this.sellers.length;r++){if(parseInt(this._seller,10)===parseInt(this.sellers[r].id,10)){this.seller=this.sellers[r]}}var o=new t;o.setData(this.seller);this.getView().setModel(o);this.oSellersProductModel=new t;this.oSellersProductModel.loadData("http://localhost:8080/GiftShop/api/sellers/"+this.seller.id+"/products","",false);this.sellersProducts=this.oSellersProductModel.getData();this.getView().byId("sellersProductList").setModel(this.oSellersProductModel)},onExit:function(){this.oRouter.getRoute("Sellers").detachPatternMatched(this._onProductMatched,this);this.oRouter.getRoute("Seller").detachPatternMatched(this._onProductMatched,this)},handleIconTabBarSelect:function(e){if(e.getParameter("key")==="modify"){this.getView().byId("footer").setVisible(true);this.getView().byId("saveButton").setVisible(true);this.getView().byId("cancelButton").setVisible(true);this.getView().byId("idSellerAddProduct").setVisible(false)}else if(e.getParameter("key")==="products"){this.getView().byId("footer").setVisible(true);this.getView().byId("saveButton").setVisible(false);this.getView().byId("cancelButton").setVisible(false);this.getView().byId("idSellerAddProduct").setVisible(true)}else{this.getView().byId("footer").setVisible(false)}},onSellerProductButtonPress:function(){this.addSellerProductDialog=sap.ui.xmlfragment("Project.Project.view.Fragments.AddSellerProduct",this);this.addSellerProductDialog.setModel(this.getView().getModel());this.getView().addDependent(this.addSellerProductDialog);this.addSellerProductDialog.open()},onAddSellerProductButtonPress:function(){this.createSellerProduct()},onCloseSellerProductButtonPress:function(){this.addSellerProductDialog.close();this.addSellerProductDialog.destroy()},checkSellerData:function(e){var t=this.getView().getModel("i18n").getResourceBundle();if(e.name===""||e.address.country===""||Number.isNaN(e.address.zipCode)||e.address.city===""||e.address.street===""||e.address.houseNumber===""){l.error(t.getText("SellersModifyErrorMessage_Empty"));return false}if(e.accountNumber.length<24){l.error(t.getText("SellersModifyErrorMessage_AccountNumber"));return false}var r=/^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;if(!e.email.match(r)){l.error(t.getText("SellersModifyErrorMessage_Email"));return false}var o=/((?:\+?3|0)6)(?:-|\(|\s)?(\d{1,2})(?:-|\)|\s)?(\d{3})(?:-|\)|\s)?(\d{3,4}|)/;if(!e.phone.match(o)){l.error(t.getText("SellersModifyErrorMessage_Phone"));return false}if(!Number.isNaN(e.address.floor)){if(Number(e.address.floor)<-20||Number(e.address.floor)>20){l.error(t.getText("SellersModifyErrorMessage_Floor"));return false}}if(!Number.isNaN(e.address.door)){if(Number(e.address.door)<0||Number(e.address.door)>1e3){l.error(t.getText("SellersModifyErrorMessage_Door"));return false}}if(!Number.isNaN(e.address.doorbell)){if(Number(e.address.doorbell)<0||Number(e.address.doorbell)>1e3){l.error(t.getText("SellersModifyErrorMessage_Doorbell"));return false}}return true},checkSellerProductData:function(e){if(e.name===""||Number.isNaN(e.price)){return false}if(Number(e.price)<0||Number(e.price)>1e5){return false}return true},checkSellerDelete:function(){this.oSellerInvoiceModel=new t;this.oSellerInvoiceModel.loadData("http://localhost:8080/GiftShop/api/sellerinvoices","",false);this.sellerInvoices=this.oSellerInvoiceModel.getData();for(var e=0;e<this.sellerInvoices.length;e++){if(parseInt(this.sellerInvoices[e].id,10)===parseInt(this._seller)){return false}}return true},onDeleteButtonPress:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=this.checkSellerDelete();if(t){var r=this;l.confirm(e.getText("ConfirmDelete"),{actions:[l.Action.YES,l.Action.NO],onClose:function(e){if(e===l.Action.YES){r.deleteClient()}}})}else{l.error(e.getText("SellerDeleteErrorMessage"),{id:"idSellerDeleteErrorMessageBox"})}},deleteClient:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=parseInt(this.seller.id,10);var r={id:t};jQuery.ajax({type:"DELETE",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/sellers/"+t,dataType:"json",data:JSON.stringify(r)});var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("Sellers",true);window.location.reload()},modify:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t={id:parseInt(this.seller.id,10),name:this.getView().byId("name").getValue(),address:{id:parseInt(this.seller.address.id,10),country:this.getView().byId("country").getValue(),zipCode:this.getView().byId("zip").getValue(),city:this.getView().byId("city").getValue(),street:this.getView().byId("street").getValue(),houseNumber:this.getView().byId("houseNumber").getValue(),floor:parseInt(this.getView().byId("floor").getValue(),10),door:parseInt(this.getView().byId("door").getValue(),10),doorbell:parseInt(this.getView().byId("doorbell").getValue(),10)},phone:this.getView().byId("phone").getValue(),email:this.getView().byId("email").getValue(),accountNumber:this.getView().byId("bankAccount").getValue()};var r=this.checkSellerData(t);if(r){jQuery.ajax({type:"PUT",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/sellers",dataType:"json",data:JSON.stringify(t)});var o=this;l.success(e.getText("SellerModifySuccess"),{onClose:function(e){window.location.reload();o.getView().byId("idIconTabBarNoIcons").setSelectedKey("info")}})}},createSellerProduct:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=sap.ui.getCore();var r={name:t.byId("addSellerProductName").getValue(),description:t.byId("addSellerProductDescription").getValue(),price:t.byId("addSellerProductPrice").getValue(),seller:this.seller};var o=this.checkSellerProductData(r);if(o){jQuery.ajax({type:"POST",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/sellerproducts",dataType:"json",data:JSON.stringify(r)});this.addSellerProductDialog.destroy();l.success(e.getText("ProductAddSuccess"),{onClose:function(e){window.location.reload()}})}else{l.error(e.getText("SellerProductAddErrorMessage"))}},modifySellerProduct:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=sap.ui.getCore();var r={id:parseInt(t.byId("sellerProductId").getText(),10),name:t.byId("modifySellerProductName").getValue(),description:t.byId("modifySellerProductDescription").getValue(),price:t.byId("modifySellerProductPrice").getValue(),seller:this.seller};var o=this.checkSellerProductData(r);if(o){jQuery.ajax({type:"PUT",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/sellerproducts",dataType:"json",data:JSON.stringify(r)});this.onCloseModifySPButtonPress();l.success(e.getText("ProductModifySuccess"),{onClose:function(e){window.location.reload()}})}else{l.error(e.getText("SellerProductModifyErrorMessage"))}},deleteSellerProduct:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=sap.ui.getCore();var r=parseInt(t.byId("sellerProductId").getText(),10);var o={id:r};jQuery.ajax({type:"DELETE",contentType:"application/json",url:"http://localhost:8080/GiftShop/api/sellerproducts/"+r,dataType:"json",data:JSON.stringify(o)});this.onCloseModifySPButtonPress();l.success(e.getText("ProductDeleteSuccess"),{onClose:function(e){window.location.reload()}})},onSellerProductPress:function(e){var r=e.getSource().getBindingContext();var o=parseInt(r.getProperty(null,r).id,10);for(var s=0;s<this.sellersProducts.length;s++){if(this.sellersProducts[s].id===o){var l=this.sellersProducts[s];var i=new t;i.setData(l)}}this.modifySellerProductDialog=sap.ui.xmlfragment("Project.Project.view.Fragments.ModifySellerProduct",this);this.modifySellerProductDialog.setModel(i);this.getView().addDependent(this.modifySellerProductDialog);this.modifySellerProductDialog.open()},onDeleteSPButtonPress:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=this;l.confirm(e.getText("ConfirmDelete"),{actions:[l.Action.YES,l.Action.NO],onClose:function(e){if(e===l.Action.YES){t.deleteSellerProduct()}}})},onModifySPButtonPress:function(){this.modifySellerProduct()},onCloseModifySPButtonPress:function(){this.modifySellerProductDialog.close();this.modifySellerProductDialog.destroy()},onProductSearch:function(e){var t=[];var r=e.getSource().getValue();if(r&&r.length>0){t=new i({filters:[new i("name",a.Contains,r)]})}this.getView().byId("sellersProductList").getBinding("items").filter(t,"Application")}})});