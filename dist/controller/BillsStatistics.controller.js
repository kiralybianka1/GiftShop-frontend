sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format"],function(e,t,a,i){"use strict";return e.extend("Project.Project.controller.BillsStatistics",{onInit:function(){this.oProductsModel=new t;this.oProductsModel.loadData("http://localhost:8080/GiftShop/api/products","",false);this.products=this.oProductsModel.getData();this.oSellerInvoiceModel=new t;this.oSellerInvoiceModel.loadData("http://localhost:8080/GiftShop/api/sellerinvoices","",false);this.getView().setModel(this.oSellerInvoiceModel,"acI");this.loadExpenseChart();this.loadProductChart()},loadProductChart:function(){var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var s=[];for(var o=0;o<this.products.length;o++){var r={name:this.products[o].name,netPrice:this.products[o].netPrice,grossPrice:this.products[o].grossPrice,grossSalePrice:this.products[o].grossSalePrice,taxPrice:this.products[o].grossPrice-this.products[o].netPrice,incomePrice:this.products[o].grossSalePrice-this.products[o].grossPrice};s.push(r)}var n=new t;n.setData(s);var l=this.getView().byId("productChart");this.getView().byId("productChart").setModel(n);var c=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:e.getText("ProductName"),value:"{name}"}],measures:[{name:e.getText("IncomePrice"),value:"{incomePrice}"},{name:e.getText("TaxPrice"),value:"{taxPrice}"},{name:e.getText("NetPrice"),value:"{netPrice}"}],data:{path:"/"}});l.setDataset(c);l.setVizType("stacked_bar");i.numericFormatter(a.getInstance());var d=a.DefaultPattern;l.setVizProperties({plotArea:{colorPalette:d3.scale.category20().range(),dataLabel:{formatString:d.SHORTFLOAT_MFD2,visible:false}},valueAxis:{label:{formatString:d.SHORTFLOAT}},title:{visible:"false"}});var u=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"valueAxis",type:"Measure",values:[e.getText("IncomePrice"),e.getText("TaxPrice"),e.getText("NetPrice")]}),v=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"categoryAxis",type:"Dimension",values:[e.getText("ProductName")]});l.addFeed(u);l.addFeed(v)},loadExpenseChart:function(){var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var t=this.getView().byId("expenseChart");t.setModel(this.oSellerInvoiceModel);var s=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:e.getText("InvoiceDate"),value:"{invoiceDate}"}],measures:[{name:e.getText("InvoiceTotal"),value:"{totalPrice}"}],data:{path:"/"}});t.setDataset(s);t.setVizType("line");i.numericFormatter(a.getInstance());var o=a.DefaultPattern;t.setVizProperties({plotArea:{dataLabel:{formatString:o.SHORTFLOAT_MFD2,visible:true}},valueAxis:{label:{formatString:o.SHORTFLOAT}},title:{visible:"false"}});var r=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"valueAxis",type:"Measure",values:[e.getText("InvoiceTotal")]}),n=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"categoryAxis",type:"Dimension",values:[e.getText("InvoiceDate")]});t.addFeed(r);t.addFeed(n)}})});